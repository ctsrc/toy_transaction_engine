<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This package provides transaction processing for the toy transaction engine command-line tool, or for any other crate that might wish to use it."><meta name="keywords" content="rust, rustlang, rust-lang, transaction_engine"><title>transaction_engine - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../transaction_engine/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../transaction_engine/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate transaction_engine</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.5.1</li><li><a id="all-types" href="all.html">All Items</a></li></div></ul><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="transaction_engine" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../transaction_engine/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">transaction_engine</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/transaction_engine/lib.rs.html#1-414">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This package provides transaction processing for the toy transaction engine
command-line tool, or for any other crate that might wish to use it.</p>
<p>In a production system we could imagine that this crate was in use by sofware
running across a fleet of servers, with each server handling transactions
for individual shards of users. This would work quite straightforward
for the current toy spec as the types of transactions we are concerned about
are per individual user and never between one user and the other. In theory
then, if our toy code was to be deployed to a fleet of servers, we could
shard on client id.</p>
<p>Beyond the toy spec though, something that would become a concern over time
is balancing users across the fleet of servers. Certainly there is a lot
that would need to be considered.</p>
<p>Going even further beyond the toy spec, there would certainly need to be
all kinds of interaction between the transaction processing and other
systems, and things would quickly become much more complex.</p>
<h3 id="examples-of-using-this-module"><a href="#examples-of-using-this-module">Examples of using this module</a></h3>
<p>The following shows some basic examples of processing transactions
using this module.</p>
<p>These examples also run as doc tests with <code>cargo test --workspace</code>
when said command is executed in the toy transaction engine
repository root.</p>
<p>In these examples, unwrap is used in order to keep the code short
and also because we want the doc tests to fail except where the
point is to show that invalid transactions are not accepted.</p>
<h4 id="deposits-and-withdrawals"><a href="#deposits-and-withdrawals">Deposits and withdrawals</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">transaction_engine</span>::{<span class="ident">TransactionProcessor</span>, <span class="ident">ClientId</span>, <span class="ident">TransactionId</span>, <span class="ident">Accounts</span>};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">transaction_processor</span> <span class="op">=</span> <span class="ident">TransactionProcessor::new</span>();

<span class="kw">let</span> <span class="ident">client_a</span> <span class="op">=</span> <span class="ident">ClientId::from</span>(<span class="number">1u16</span>);
<span class="kw">let</span> <span class="ident">amount_1</span> <span class="op">=</span> <span class="string">&quot;1.5000000000001&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">tx_1</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">1u32</span>);
<span class="kw">let</span> <span class="ident">tx_2</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">2u32</span>);
<span class="comment">// XXX: Precision of fractional part is four digits as per spec.</span>
<span class="comment">//      Fifth digit and onwards will be &quot;chopped off&quot;, without rounding.</span>
<span class="comment">//</span>
<span class="comment">//      In other words, the following are all equivalent:</span>
<span class="comment">//</span>
<span class="comment">//let amount_2 = &quot;0.25&quot;.try_into().unwrap();</span>
<span class="comment">//let amount_2 = &quot;0.2500&quot;.try_into().unwrap();</span>
<span class="comment">//let amount_2 = &quot;0.250099999999999999999999&quot;.try_into().unwrap();</span>
<span class="kw">let</span> <span class="ident">amount_2</span> <span class="op">=</span> <span class="string">&quot;0.25009&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();

<span class="ident">transaction_processor</span>.<span class="ident">deposit</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>, <span class="ident">amount_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">withdraw</span>(<span class="ident">client_a</span>, <span class="ident">tx_2</span>, <span class="ident">amount_2</span>).<span class="ident">unwrap</span>();

<span class="comment">// After processing the above two transactions, we expect to find that</span>
<span class="comment">// there is record of a single account, belonging to client_a. We expect that</span>
<span class="comment">// this account is not frozen, that the amount available on the account</span>
<span class="comment">// should have string representation equal to &quot;1.2500&quot;, and that the held</span>
<span class="comment">// amount on the account should have string representation</span>
<span class="comment">// equal to &quot;0.0000&quot;.</span>
<span class="kw">let</span> <span class="ident">accounts</span>: <span class="ident">Accounts</span> <span class="op">=</span> <span class="ident">transaction_processor</span>.<span class="ident">into</span>();
<span class="macro">assert_eq!</span>(<span class="ident">accounts</span>.<span class="ident">len</span>(), <span class="number">1</span>);
<span class="kw">let</span> (<span class="ident">client_id_ret</span>, <span class="ident">acc_a</span>) <span class="op">=</span> <span class="ident">accounts</span>.<span class="ident">into_iter</span>().<span class="ident">next</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="ident">client_id_ret</span>, <span class="ident">client_a</span>);
<span class="macro">assert!</span>(<span class="op">!</span><span class="ident">acc_a</span>.<span class="ident">is_frozen</span>());
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_available</span>().<span class="ident">to_string</span>(), <span class="string">&quot;1.2500&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_held</span>().<span class="ident">to_string</span>(), <span class="string">&quot;0.0000&quot;</span>);</code></pre></div>
<h4 id="dispute"><a href="#dispute">Dispute</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">transaction_engine</span>::{<span class="ident">TransactionProcessor</span>, <span class="ident">ClientId</span>, <span class="ident">TransactionId</span>, <span class="ident">Accounts</span>};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">transaction_processor</span> <span class="op">=</span> <span class="ident">TransactionProcessor::new</span>();

<span class="kw">let</span> <span class="ident">client_a</span> <span class="op">=</span> <span class="ident">ClientId::from</span>(<span class="number">1u16</span>);
<span class="kw">let</span> <span class="ident">amount_1</span> <span class="op">=</span> <span class="string">&quot;1.5&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">tx_1</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">1u32</span>);
<span class="kw">let</span> <span class="ident">tx_2</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">2u32</span>);
<span class="kw">let</span> <span class="ident">amount_2</span> <span class="op">=</span> <span class="string">&quot;0.25&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();

<span class="ident">transaction_processor</span>.<span class="ident">deposit</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>, <span class="ident">amount_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">withdraw</span>(<span class="ident">client_a</span>, <span class="ident">tx_2</span>, <span class="ident">amount_2</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">dispute</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>).<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="ident">accounts</span>: <span class="ident">Accounts</span> <span class="op">=</span> <span class="ident">transaction_processor</span>.<span class="ident">into</span>();
<span class="kw">let</span> (<span class="kw">_</span>, <span class="ident">acc_a</span>) <span class="op">=</span> <span class="ident">accounts</span>.<span class="ident">into_iter</span>().<span class="ident">next</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_available</span>().<span class="ident">to_string</span>(), <span class="string">&quot;-0.2500&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_held</span>().<span class="ident">to_string</span>(), <span class="string">&quot;1.5000&quot;</span>);</code></pre></div>
<h4 id="resolve"><a href="#resolve">Resolve</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">transaction_engine</span>::{<span class="ident">TransactionProcessor</span>, <span class="ident">ClientId</span>, <span class="ident">TransactionId</span>, <span class="ident">Accounts</span>};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">transaction_processor</span> <span class="op">=</span> <span class="ident">TransactionProcessor::new</span>();

<span class="kw">let</span> <span class="ident">client_a</span> <span class="op">=</span> <span class="ident">ClientId::from</span>(<span class="number">1u16</span>);
<span class="kw">let</span> <span class="ident">amount_1</span> <span class="op">=</span> <span class="string">&quot;1.5&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">tx_1</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">1u32</span>);
<span class="kw">let</span> <span class="ident">tx_2</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">2u32</span>);
<span class="kw">let</span> <span class="ident">amount_2</span> <span class="op">=</span> <span class="string">&quot;0.25&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();

<span class="ident">transaction_processor</span>.<span class="ident">deposit</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>, <span class="ident">amount_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">withdraw</span>(<span class="ident">client_a</span>, <span class="ident">tx_2</span>, <span class="ident">amount_2</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">dispute</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">resolve</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>).<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="ident">accounts</span>: <span class="ident">Accounts</span> <span class="op">=</span> <span class="ident">transaction_processor</span>.<span class="ident">into</span>();
<span class="kw">let</span> (<span class="kw">_</span>, <span class="ident">acc_a</span>) <span class="op">=</span> <span class="ident">accounts</span>.<span class="ident">into_iter</span>().<span class="ident">next</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_available</span>().<span class="ident">to_string</span>(), <span class="string">&quot;1.2500&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_held</span>().<span class="ident">to_string</span>(), <span class="string">&quot;0.0000&quot;</span>);</code></pre></div>
<h4 id="chargeback"><a href="#chargeback">Chargeback</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">transaction_engine</span>::{<span class="ident">TransactionProcessor</span>, <span class="ident">ClientId</span>, <span class="ident">TransactionId</span>, <span class="ident">Accounts</span>};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">transaction_processor</span> <span class="op">=</span> <span class="ident">TransactionProcessor::new</span>();

<span class="kw">let</span> <span class="ident">client_a</span> <span class="op">=</span> <span class="ident">ClientId::from</span>(<span class="number">1u16</span>);
<span class="kw">let</span> <span class="ident">amount_1</span> <span class="op">=</span> <span class="string">&quot;1.5&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">tx_1</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">1u32</span>);
<span class="kw">let</span> <span class="ident">tx_2</span> <span class="op">=</span> <span class="ident">TransactionId::from</span>(<span class="number">2u32</span>);
<span class="kw">let</span> <span class="ident">amount_2</span> <span class="op">=</span> <span class="string">&quot;0.25&quot;</span>.<span class="ident">try_into</span>().<span class="ident">unwrap</span>();

<span class="ident">transaction_processor</span>.<span class="ident">deposit</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>, <span class="ident">amount_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">withdraw</span>(<span class="ident">client_a</span>, <span class="ident">tx_2</span>, <span class="ident">amount_2</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">dispute</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>).<span class="ident">unwrap</span>();
<span class="ident">transaction_processor</span>.<span class="ident">chargeback</span>(<span class="ident">client_a</span>, <span class="ident">tx_1</span>).<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="ident">accounts</span>: <span class="ident">Accounts</span> <span class="op">=</span> <span class="ident">transaction_processor</span>.<span class="ident">into</span>();
<span class="kw">let</span> (<span class="kw">_</span>, <span class="ident">acc_a</span>) <span class="op">=</span> <span class="ident">accounts</span>.<span class="ident">into_iter</span>().<span class="ident">next</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_available</span>().<span class="ident">to_string</span>(), <span class="string">&quot;-0.2500&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_held</span>().<span class="ident">to_string</span>(), <span class="string">&quot;0.0000&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">acc_a</span>.<span class="ident">get_total</span>().<span class="ident">to_string</span>(), <span class="string">&quot;-0.2500&quot;</span>);
<span class="macro">assert!</span>(<span class="ident">acc_a</span>.<span class="ident">is_frozen</span>());</code></pre></div>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Account.html" title="transaction_engine::Account struct">Account</a></div><div class="item-right docblock-short"><p>Contains the account data for a single user.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ClientId.html" title="transaction_engine::ClientId struct">ClientId</a></div><div class="item-right docblock-short"><p>Client ID is represented by u16 integer as per spec.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FractionalAmount.html" title="transaction_engine::FractionalAmount struct">FractionalAmount</a></div><div class="item-right docblock-short"><p>Transaction amount is precise to four places past the decimal point in inputs
and outputs. Therefore, we represent the amount internally as integer fractional
amounts of 1/10,000ths (one ten thousands) of the i/o amount unit.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TransactionId.html" title="transaction_engine::TransactionId struct">TransactionId</a></div><div class="item-right docblock-short"><p>Transaction ID is represented by u32 integer as per spec.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TransactionProcessor.html" title="transaction_engine::TransactionProcessor struct">TransactionProcessor</a></div><div class="item-right docblock-short"><p>Processes transactions and provides final balances for accounts for which
transactions have been processed.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.FractionalAmountParseError.html" title="transaction_engine::FractionalAmountParseError enum">FractionalAmountParseError</a></div><div class="item-right docblock-short"><p>Errors returned for <a href="https://doc.rust-lang.org/1.60.0/core/convert/trait.TryInto.html#tymethod.try_into" title="TryInto::try_into">TryInto::try_into</a>::&lt;<a href="struct.FractionalAmount.html" title="FractionalAmount">FractionalAmount</a>&gt; on &amp;<a href="https://doc.rust-lang.org/1.60.0/std/primitive.str.html" title="str">str</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TransactionChargebackError.html" title="transaction_engine::TransactionChargebackError enum">TransactionChargebackError</a></div><div class="item-right docblock-short"><p>Errors returned by <a href="struct.TransactionProcessor.html#method.chargeback" title="TransactionProcessor::chargeback">TransactionProcessor::chargeback</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TransactionDepositError.html" title="transaction_engine::TransactionDepositError enum">TransactionDepositError</a></div><div class="item-right docblock-short"><p>Errors returned by <a href="struct.TransactionProcessor.html#method.withdraw" title="TransactionProcessor::withdraw">TransactionProcessor::withdraw</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TransactionDisputeError.html" title="transaction_engine::TransactionDisputeError enum">TransactionDisputeError</a></div><div class="item-right docblock-short"><p>Errors returned by <a href="struct.TransactionProcessor.html#method.dispute" title="TransactionProcessor::dispute">TransactionProcessor::dispute</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TransactionResolveError.html" title="transaction_engine::TransactionResolveError enum">TransactionResolveError</a></div><div class="item-right docblock-short"><p>Errors returned by <a href="struct.TransactionProcessor.html#method.resolve" title="TransactionProcessor::resolve">TransactionProcessor::resolve</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TransactionWithdrawError.html" title="transaction_engine::TransactionWithdrawError enum">TransactionWithdrawError</a></div><div class="item-right docblock-short"><p>Errors returned by <a href="struct.TransactionProcessor.html#method.withdraw" title="TransactionProcessor::withdraw">TransactionProcessor::withdraw</a>.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Accounts.html" title="transaction_engine::Accounts type">Accounts</a></div><div class="item-right docblock-short"><p>Contains the accounts of all users for which we have processed valid transactions.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="transaction_engine" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0 (7737e0b5c 2022-04-04)" ></div>
</body></html>